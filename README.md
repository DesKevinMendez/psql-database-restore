# PostgreSQL Database Restore and SQL Generator

This project provides a Docker-based solution for restoring PostgreSQL database dumps and generating SQL insert statements. Generated by AI (Claude 3.5 Sonnet).

## Features

- Restores PostgreSQL dump files
- Generates SQL files with CREATE and INSERT statements
- Supports both pg_restore and psql fallback methods
- Configurable through environment variables

## Supported Dump Formats

The project supports the following PostgreSQL dump formats:
- Custom format dumps (`.dump` files created with `pg_dump -Fc`)
- Plain SQL dumps (`.sql` files)
- Directory format dumps (created with `pg_dump -Fd`)

## Prerequisites

- Docker
- Docker Compose
- PostgreSQL dump file

## Configuration

### Environment Variables

Edit `docker-compose.yml` to configure the following variables:

```
POSTGRES_USER: postgres
POSTGRES_PASSWORD: postgres
POSTGRES_DB: prod-my-database
DUMP_PATH: /dumps/your-dump-file.dump
```


### Port Configuration

The default PostgreSQL port mapping is `5440:5432`. Modify in `docker-compose.yml` if needed:


## Usage

1. Place your PostgreSQL dump file in the `dumps` directory

2. Update the `DUMP_PATH` in `docker-compose.yml` to match your dump file name

3. Start the container:


4. The script will:
   - Restore the database from the dump file
   - Generate a new SQL file with INSERT statements
   - Save the generated SQL as `database_tables_and_inserts.sql` in the dumps directory

5. Find the generated SQL file in `dumps/database_tables_and_inserts.sql`

## Output Files

- `database_tables_and_inserts.sql`: Contains CREATE TABLE statements and INSERT statements for all data

## Troubleshooting

If you encounter errors during restore:
1. The script will automatically try an alternative restore method
2. Check the console output for specific error messages
3. Verify that your dump file format is supported
4. Ensure the dump file has the correct permissions

## Notes

- The generated SQL file includes both schema and data
- All statements are generated without owner to avoid permission issues
- Foreign key constraints and triggers are handled automatically

## License

This project is open-source and available under the MIT License.

## Generated by AI

This project was generated with the assistance of Claude 3.5 Sonnet, an AI language model by Anthropic. While the code is functional and tested, it's recommended to review and test thoroughly before using in production environments.